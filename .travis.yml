services:
  - postgresql
addons:
  postgresql: "9.6"
matrix:
  include:
    - language: rust
      before_script:
        - psql -c "CREATE USER kenkoooo PASSWORD 'pass';" -U postgres
        - psql -c "CREATE DATABASE test OWNER kenkoooo;" -U postgres
      script:
        - cd atcoder-problems-api-lambda/
        - cargo test
        - cd ../
        - cd atcoder-problems-scraper/
        - cargo test
        - cd ../
        - cd atcoder-problems-sql-common/
        - RUST_TEST_THREADS=1 cargo test
        - cd ../
        - cd atcoder-problems-updater-lambda/
        - RUST_TEST_THREADS=1 cargo test
        - cd ../
    - language: node_js
      node_js: node
      before_script:
        - cd atcoder-problems-frontend
      script:
        - npm install yarn -g
        - yarn
        - yarn build
      after_success:
        - cd ../
